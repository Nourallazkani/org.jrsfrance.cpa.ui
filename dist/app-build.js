System.register("common.js",[],function(a){"use strict";var b,c,d;return{setters:[],execute:function(){b=function(){function a(){babelHelpers.classCallCheck(this,a)}return babelHelpers.createClass(a,[{key:"language",get:function(){return localStorage.getItem("language")},set:function(a){localStorage.setItem("language",a)}},{key:"profile",get:function(){return localStorage.getItem("profile")},set:function(a){localStorage.setItem("profile",a)}}]),a}(),a("UserDetails",b),c=function(){function a(){babelHelpers.classCallCheck(this,a)}return babelHelpers.createClass(a,[{key:"getUri",value:function(a,b){if(b){var c=[];for(var d in b){var e=b[d];e&&c.push(d+"="+e)}return c.length>0?a+"?"+c.join("&"):a}return a}}]),a}(),a("Global",c),d=function e(){babelHelpers.classCallCheck(this,e)},a("ViewModel",d)}}}),System.register("app.js",["aurelia-framework","aurelia-fetch-client","aurelia-router","common"],function(a){"use strict";var b,c,d,e,f,g,h;return{setters:[function(a){b=a.inject},function(a){c=a.HttpClient,d=a.json},function(a){e=a.Router},function(a){f=a.Global,g=a.UserDetails}],execute:function(){h=function(){function a(a,b,c,d){babelHelpers.classCallCheck(this,h),this.authz={silent:!1,input:null,outcome:null},this.messages={common:{Rechercher:{en:"Search"}},cursus:{Niveau:{en:"Level"}}},this.httpClient=a,this.global=b,this.userDetails=c,this.httpClient.configure(function(a){a.withBaseUrl("http://127.0.0.1:8080/api/").withDefaults({headers:{}}).withInterceptor({request:function(a){return console.log("Requesting "+a.method+" "+a.url),a},response:function(a){if(console.log("Received "+a.status+" "+a.url),a.status>=400&&a.status<=599)throw a;return a}})}),this.httpClient.fetch("referenceData").then(function(a){return a.json()}).then(function(a){return b.referenceData=a}),null!=localStorage.getItem("accessKey")&&(this.authz.silent=!0,this.authz.action="sign-in",this.authz.input={accessKey:localStorage.getItem("accessKey")},this.processSignIn())}babelHelpers.createClass(a,[{key:"configureRouter",value:function(a,b){a.title="CPA",a.options.pushState=!0,a.options.hashChange=!1,a.map([{route:["","index"],name:"index",moduleId:"./views/index",nav:!0,title:"Index"},{route:"refugees",name:"refugees/index",moduleId:"./views/refugees/index",nav:!0,title:"RÃ©fugiÃ©s"},{route:"organisations",name:"organisations/index",moduleId:"./views/organisations/index",nav:!0,title:"Organisation"}]),this.router=b}},{key:"startSignIn",value:function(){this.authz.action="sign-in",this.authz.input={realm:this.userDetails.profile},this.authz.outcome=null}},{key:"processSignIn",value:function(a){var b=this;this.httpClient.fetch("authz/signIn",{method:"POST",body:d(this.authz.input)}).then(function(a){return a.json()}).then(function(c){b.userDetails.account=c,b.userDetails.accessKey=c.accessKey,b.authz.action=null,b.authz.rememberMe&&localStorage.setItem("accessKey",c.accessKey),null!=a&&b.router.navigateToRoute(a)})["catch"](function(a){b.authz.outcome="failure"})}},{key:"startPasswordRecoveryRequest",value:function(){this.authz.action="recover-password",this.authz.input.password=null,this.authz.outcome=null}},{key:"processPasswordRecovery",value:function(){var a=this;console.log(this.authz.input),this.httpClient.fetch("authz/passwordRecovery",{method:"POST",body:d(this.authz.input)}).then(function(){return a.authz.outcome="accepted"})}},{key:"cancelSignIn",value:function(){this.authz.action=null}},{key:"signOut",value:function(){this.userDetails.account=null,this.userDetails.accessKey=null,localStorage.removeItem("accessKey")}},{key:"i18n",value:function(a,b){var c=this.messages[null==b?"common":b][a];return"fr"==this.userDetails.language?a:c[this.userDetails.language]}}]);var h=a;return a=b(c,f,g,e)(a)||a}(),a("App",h)}}});