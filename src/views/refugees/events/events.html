<template>

  <require from="views/_components/place-autocomplete"></require>
  <require from="views/_formatters/date-format"></require>
  <require from="views/_components/gmap"></require>


  <form class="search-inline-form" fixed-if-on-top>

    <select value.bind="filter.city">
      <option value="">Ville</option>
      <option repeat.for="x of referenceData.cities.languageLearningProgram">${x}</option>
    </select>

    <button class="btn-orange" click.trigger="find('list')" class="${view=='list' ? 'button-active' : ''}">Voir liste</button>
    <button class="btn-orange" click.trigger="find('map')" class="${view=='map' ? 'button-active' : ''}">Voir carte</button>
  </form>

  <div class="_results" if.bind="results.length>0 && view=='map'">
    <gmap center.bind="userDetails.address" places.bind="results"></gmap>
  </div>

  <div class="_results" if.bind="results.length>0 && view=='list'">
    <div style="text-align:right;margin-bottom:25px">
      <form submit.delegate="sortByDistance()">
        <input type="text" placeholder="Votre adresse" place-autocomplete="target.bind: userDetails" />
        <button>Classer par proximité</button>
      </form>
    </div>

    <div class="_result" repeat.for="r of results" style="margin-bottom:70px">

      <!--
      <div class="width-lg-15" style="font-size:25px;font-style:italic;text-align:center">
        <img src="/assets/img/saif/Date.svg" style="width:40px"><br/> ${r.item.startDate | myDateFormat:'DD MMM'}
      </div>
      -->
      <div class="width-lg-100 vertical">
        <div class="_result-header horizontal">
          <div class="width-lg-80" style="text-align:left">
            <img src="/assets/img/saif/Date.svg" style="width:40px;margin-right:30px;vertical-align:middle">
            ${r.item.startDate | myDateFormat:'DD MMMM'}
          </div>
          <div class="width-lg-20" style="text-align:right" if.bind="r.distance">
            <a if.bind="userDetails.address" click.delegate="viewItinerary(userDetails.address, r.item.address)">
            ${r.distance} km
          </a>
          </div>
        </div>

        <div class="_result-body horizontal">

          <div class="_image-container" style="background-image:url('/assets/img/saif/teaching.svg')">

            <div class="fit-to-content" if.bind="moment(r.item.registrationOpeningDate).diff()>0">
              Ouverture des inscriptions le ${r.item.registrationOpeningDate | myDateFormat:'DD/MM'}
            </div>
            <div class="fit-to-content" if.bind="moment(r.item.registrationOpeningDate).diff()<0">
              Cloture des inscriptions le ${r.item.registrationClosingDate | myDateFormat:'DD/MM'}
            </div>

          </div>

          <div class="vertical _infos-container">

            <img src="/assets/img/common/arrow-right-saif.svg" style="position:absolute; width:30px;height:30px; right:100%; bottom:25%;">
            <div class="horizontal">
              <div class="width-lg-40 info-title">
                <img src="/assets/img/saif/Date.svg" /> Heure
              </div>
              <div class="width-lg-60 info-text">
                De ${r.item.startDate | myDateFormat:'HH:mm'} à ${r.item.endDate | myDateFormat:'HH:mm'}
              </div>
            </div>
            <div class="horizontal">
              <div class="width-lg-40 info-title">
                <img src="/assets/img/saif/Contact.svg" /> Contact
              </div>
              <div class="width-lg-60 info-text">
                ${r.item.contact.name} <br/> ${r.item.contact.phoneNumber} <br/>
                <a href="mailto:${r.contact.mailAddress}">${r.item.contact.mailAddress}</a>
              </div>
            </div>
            <div class="horizontal">
              <div class="width-lg-40 info-title">
                <a click.delegate="viewLocation(r.item.address)"> <img src="/assets/img/saif/Address.svg" /> Adresse </a>
              </div>
              <div class="width-lg-60 info-text">
                ${r.item.address.street1}<br/> ${r.item.address.street2}
                <br if.bind="r.item.address.street2 != null " /> ${r.item.address.postalCode} ${r.item.address.locality}
              </div>
            </div>

          </div>
        </div>
        <div class="_result-body">
          <div style="background-color:#e7e9e8;padding:5px">
            Organisé par ${r.item.organisedBy}

            <div style="font-family:SegoeUiSlim;text-align:justify;padding:10px">
              
              <p>${r.item.description}</p>

              <p style="text-align:right;font-weight:bold">
                En savoir plus...
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--
      <div class="_event-image-container" style="background:url('/assets/img/unsorted/sorbonne.jpg') no-repeat center;background-size:cover;">
        <a class="link-big link-top" style="right:10%" href="#"> <img src="/assets/img/saif/Gotolink-icon.svg" /></a>
        <div class="fit-to-content">
          Organisé par : ${r.item.organisedBy}
        </div>
        <br/>
        <div class="fit-to-content" if.bind="moment(r.item.registrationStartDate).diff()>0">
          Ouverture des inscriptions : ${r.item.registrationStartDate | myDateFormat:'DD/MM/YYYY'}
        </div>
      </div>
      <div class="_event-infos-container">
        <h2> ${r.item.subject} </h2>
        <p style="text-align:justifyfont-size: 15px;line-height: 20px;font-family: segoeui;">
          ${r.item.description}
        </p>
        <div class="horizontal">
          <div>
            <a click.delegate="viewLocation(r.item.address)"> <img class="icon" src="/assets/img/saif/Address.svg" />Adresse :</a>
            ${r.item.address.street1} ${r.item.address.street2} ${r.item.address.postalCode} ${r.item.address.locality}
          </div>
          <div style="position:absolute; right:0%; transform: translateX(-100%);" if.bind="r.distance">
            <a if.bind="userDetails.address" click.delegate="viewItinerary(userDetails.address, r.item.address)">
            ${r.distance} km
          </a>
          </div>
        </div>
        <p>
          <img class="icon" src="/assets/img/saif/Contact.svg" /> Contact : ${r.item.contact.name} (<a href="mailto:${r.contact.mailAddress}">${r.item.contact.mailAddress}</a>,
          téléphone : ${r.item.contact.phoneNumber})
        </p>
        <p>
          <img class="icon" src="/assets/img/saif/Date.svg" />Début : ${r.item.startDate | myDateFormat:'DD/MM/YYYY'} - Fin
          : ${r.item.endDate | myDateFormat:'DD/MM/YYYY'}
        </p>
      </div>
      <div class="_event-result-footer" style="background-color:black;">c</div>
    </div>
    -->
  </div>
</template>